@model  Emblishment_Management_System.Models.emsGRN.emsGrnTD

<div class="col-md-4">
    
    <div class="form-group">
        <label>Sales Order</label>
        @Html.EditorFor(model => model.SO, new { htmlAttributes = new { @class = "form-control", placeholder = "SO", @Id = "SO", @autocomplete = "off" } })
    </div>

    <div class="form-group">
        <label>Stock Type</label>
        @Html.DropDownListFor(model => model.StockTypeCode, (IEnumerable<SelectListItem>)(ViewBag.StockTypeCode), "Select Stock Type", new { @class = "form-control select2", @style = "width: 100%;", required = "required" , @Id = "StockTypeCode" })
    </div>

    <div class="form-group">
        <label>Grn Qty</label>
        @Html.EditorFor(model => model.GrnQty, new { htmlAttributes = new { @class = "form-control", placeholder = "Grn Qty" ,@Id= "GrnQty" } })
    </div>

</div>
<div class="col-md-4">
    <div class="form-group">
        <label>SG Style</label>
        @*@Html.EditorFor(model => model.SGStyle, new { htmlAttributes = new { @class = "form-control", placeholder = "SG Style", @Id = "SGStyle", @autocomplete = "off" } })*@
        
        @Html.DropDownListFor(model => model.SGStyle, Enumerable.Empty<SelectListItem>(), "Select SG Style", new { @class = "form-control select2", @style = "width: 100%;", @Id = "SGStyle", required = "required", @onchange = "FillSGComponents();" })
    </div>

    <div class="form-group">
        <label>Docket</label>
        @Html.EditorFor(model => model.Docket, new { htmlAttributes = new { @class = "form-control", placeholder = "Docket", @Id= "Docket" } })
    </div>

    <div class="form-group">
        <label>&nbsp;</label><br>
        <div class="btn btn-group">
        <button type="submit" class="btn btn-primary" onclick="GrnItems(this, event);">Add Item</button>
        <button type="reset" class="btn btn-success">&nbsp;Reset &nbsp;&nbsp;</button>
        </div>
    </div>
</div>

<div class="col-md-4">
    <div class="form-group">
        <label>SG Component</label>
        @Html.DropDownListFor(model => model.SGComponent, Enumerable.Empty<SelectListItem>(), "Select SG Component", new { @class = "form-control select2", @style = "width: 100%;", @Id = "SGComponent" })
    </div>


    <div class="form-group">
        <label>Size</label>
        @Html.DropDownListFor(model => model.Size, Enumerable.Empty<SelectListItem>(), "Select Size", new { @class = "form-control select2", @style = "width: 100%;", @Id = "Size", required = "required" })
        
        @*@Html.EditorFor(model => model.Size, new { htmlAttributes = new { @class = "form-control", placeholder = "Size" } })*@
    </div>

</div>



<script type="text/javascript">
    function GrnItems(ctrl, event) {
        event.preventDefault();

        if ($('#SO').val() == "")
        {
            $("#SO").focus();
            bootbox.alert('Please select a sales order.');
        }
        else if ($('#SGStyle option:selected').val() == "")
        {
            $("#SGStyle").focus();
            bootbox.alert('Please select SG Style.');
        }
        else if ($('#SGComponent option:selected').val() == "")
        {
            $("#SGStyle").focus();
            bootbox.alert('Please select SG Component.');
        }
        else if ($('#StockTypeCode option:selected').val() == "") {
            $("#StockTypeCode").focus();
            bootbox.alert('Please select Stock Type.');
        }
        else if ($('#Docket').val() == "") {
            $("#Docket").focus();
            bootbox.alert('Please enter docket no.');
        }
        else if ($('#Size').val() == "") {
            $("#Size").focus();
            bootbox.alert('Please select Size.');
        }
        else if ($('#Size').val() != 'all' &&  $('#GrnQty').val() <= 0) {
            $("#GrnQty").focus();
            bootbox.alert('You entered valid grn qty.');
        }
        else
        {
            $.ajax({
                url: '@Url.Action("PartialGRNDetails", "GRN")',
                type: "POST",
                data: $("form").serialize(),
                success: function (result) {
                    $("#divPartialView").html(result);
                }
            });
        }
    }
</script>


<script type="text/javascript">
    //AutoComplete for SGStyle
    $(function () {
        $("#SGStyle").typeahead({
            hint: true,
            highlight: true,
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("AutoCompleteSG", "GRN")',
                    data: "{ 'prefix': '" + request + "'}",
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        items = [];
                        map = {};
                        $.each(data, function (i, item) {
                            var id = item.value;
                            var name = item.text;
                            map[name] = { id: id, name: name };
                            items.push(name);
                        });
                        response(items);
                        $(".dropdown-menu").css("height", "auto");
                    }
                });
            },
            updater: function (item) {
                //$('#hfSGStyle').val(map[item].id);
                $.ajax({
                    url: '@Url.Action("getSGComponentFromSG", "GRN")',
                    type: "POST",
                    dataType: "JSON",
                    data: { SGStyle: map[item].id },
                    success: function (data) {
                        $("#SGComponent").html(""); // clear before appending new list
                        $("#SGComponent").append($('<option></option>').val('').html("Select SG Component"));
                        $.each(data, function (i, item) {
                            $("#SGComponent").append(
                                $('<option></option>').val(item.value).html(item.text));
                        });

                        var SG = $("#SO").val(null);
                    }
                });

                return item;
            }
        });
    });


    //AutoComplete for SO
    $(function () {
        $("#SO").typeahead({
            hint: true,
            highlight: true,
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("AutoCompleteSalesOrder", "GRN")',
                    data: "{ 'prefix': '" + request + "'}",
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        items = [];
                        map = {};
                        $.each(data, function (i, item) {
                            var id = item.value;
                            var name = item.text;
                            map[name] = { id: id, name: name };
                            items.push(name);
                        });
                        response(items);
                        $(".dropdown-menu").css("height", "auto");
                    }
                });
            },
            updater: function (item) {

                //Load SG styles from sales order
                $.ajax({
                    url: '@Url.Action("getSGStyleFormSO", "GRN")',
                    type: "POST",
                    dataType: "JSON",
                    data: { prefix: map[item].id },
                    success: function (data) {
                        $("#SGStyle").html(""); // clear before appending new list
                        $("#SGStyle").append($('<option></option>').val('').html("Select SG Style"));
                        $.each(data, function (i, item) {
                            $("#SGStyle").append(
                                $('<option></option>').val(item.value).html(item.text));
                        });
                    }
                });


                //Load sizes from sales order
                $.ajax({
                    url: '@Url.Action("getSizesFormSO", "GRN")',
                    type: "POST",
                    dataType: "JSON",
                    data: { SalesOrder: map[item].id },
                    success: function (data) {
                        $("#Size").html(""); // clear before appending new list
                        $("#Size").append($('<option></option>').val('').html("Select Size"));
                        $("#Size").append($('<option></option>').val('all').html("All Sizes"));
                        $.each(data, function (i, item) {
                            $("#Size").append(
                                $('<option></option>').val(item.value).html(item.text));
                        });
                    }
                });

                return item;
            }
        });
    });

    function FillSGComponents() {
        var SGStyle = $('#SGStyle').val();
        $.ajax({
            url: '@Url.Action("getSGComponentFromSG", "GRN")',
            type: "POST",
            dataType: "JSON",
            data: { SGStyle: SGStyle },
            success: function (result) {
                $("#SGComponent").html(""); // clear before appending new list
                $("#SGComponent").append($('<option></option>').val(null).html("Select SG Component"));
                $.each(result, function (i, item) {
                    $("#SGComponent").append(
                        $('<option></option>').val(item.value).html(item.text));
                });
            }
        });

    }
</script>

